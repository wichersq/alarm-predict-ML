# ML Alarm Predict
This project is for predicting when a user should start getting ready to go to an appointment. The code generates data and trains a ML model to accomplish this. The data is generated using the google maps API. To bootstrap the model training, a fake time that the user takes to get ready is generated by a simple equation. A fully connected neural network is trained on that data to predict the time it takes the user to get ready and go to their appointment.
## Motivation
Personal assistants are becoming more popular but I'm not sure of one that can tell you when you have to start getting ready to leave for a calendar event. Some can tell you how long it will take to drive there, but there are also other factors to consider, such as the time it takes the user to get ready, how busy the place their going is, how fancy the place their going is. I wanted to create something that would take these other features into account to tell me when I would have to start getting ready to go somewhere. A use case is automatically setting the user's alarm based on their calendar appointment.
## Results
The model is off by about 3 minutes on average on the test data. Removing features like the number of reviews leads to worse accuracy of about 4.25 minutes. 

## Details
### Generating data
The data has the following features:

 - Travel time by car, bike, walking and transit.
 - The closing and opening time.
 - The number of reviews.
 - The average rating.
 - How expensive the place is.

I used [botsol](http://www.botsol.com/Products/GoogleMapsCrawler) to get addresses of places that users might go to, and exported them to [Places_info.csv](https://github.com/wichersq/alarm-predict-ML/blob/master/Data/Places_info.csv), which contains 18k addresses. Then I used the google maps API and pandas to get the other features (implemented in [generate_data.py](https://github.com/wichersq/alarm-predict-ML/blob/master/generate_data.py)) and saved the data to [raw_data.csv](https://github.com/wichersq/alarm-predict-ML/blob/master/Data/raw_data.csv "raw_data.csv"). To bootstrap a ML model, I created a fake time for the user to get ready based on an equation defined in [generate_fake_result.py](https://github.com/wichersq/alarm-predict-ML/blob/master/generate_fake_result.py "generate_fake_result.py"). From this process, I got about 3k examples to train the network on (cause I ran out of free Google maps API credits). The equation assumes that it will take the user longer to get ready for a place that's more expensive, and that a place with more reviews is more popular so people will want to get there earlier. The data with the fake get ready time is saved in [converted_data_with_totalDuration.csv](https://github.com/wichersq/alarm-predict-ML/blob/master/Data/converted_data_with_totalDuration.csv "converted_data_with_totalDuration.csv")
### Model
The model is a 5 layer fully connected network that takes in the features defined above. It outputs how long before the event the user should start getting ready. It is implemented in Tensorflow. Values in the data are sometimes nan, so the preprocessing code sets these to -1 and defines another column which indicates if the feature was originally nan or not.
## Future work

 - Use real data instead of fake data. For example by making an app where the user can enter how late or early they were to an appointment when they started getting ready when the model predicted.
 - Use more features, like the availability of parking. 
 - Personalize the model for different users. For example by feeding a user ID into the model.

## To Run
### Running the ML model [timePredML.ipynb](https://github.com/wichersq/alarm-predict-ML/blob/master/timePredML.ipynb "timePredML.ipynb")
The simplest way is to run it in colab by clicking "View in Colaboratory" at the top of the file. Then you can select Runtime->Run all.
### Generating the data
You'll need a [google maps API key](https://developers.google.com/maps/documentation/javascript/get-api-key) and enable the dirrections and places APIs. A free account should let you generate a lot of the data. Put the API key in API_KEY.txt.
You will have to install (pandas)[https://pandas.pydata.org/], and the google maps API python libraries: (googlemaps)[https://github.com/googlemaps/google-maps-services-python] and (googleplaces)[https://github.com/slimkrazy/python-google-places].
Then run [generate_data.py](https://github.com/wichersq/alarm-predict-ML/blob/master/generate_data.py "generate_data.py") and [generate_fake_result.py](https://github.com/wichersq/alarm-predict-ML/blob/master/generate_fake_result.py "generate_fake_result.py") with python. Double check that file paths defined in the code are suitable.
